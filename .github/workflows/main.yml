name: 'ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒ†ã‚¹ãƒˆï¼‹æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤'

on:
  push:
    branches:
      - main  # mainãƒ–ãƒ©ãƒ³ãƒã¸ã®pushã§å®Ÿè¡Œ

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # ğŸ”¹ ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ç’°å¢ƒä¸Šã§ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
      - name: "ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ"
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.DEV_SSH_HOST }}
          port: ${{ secrets.DEV_SSH_PORT }}
          username: ${{ secrets.DEV_SSH_USER }}
          key: ${{ secrets.DEV_SSH_KEY }}
          script: |
            cd /ci/
            npx cypress run --browser chrome --spec cypress/e2e/kanta_maruhashi.cy.js
            echo "ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...ï½²ï½¹ï½°ï½¯!"
            echo "ï½¸ï¾˜ï½±ï½°ï½¯!!"

      # ğŸ”¹ ãƒ†ã‚¹ãƒˆæˆåŠŸæ™‚ã®ã¿ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
      - name: "æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤"
        if: success()
        uses: appleboy/ssh-action@v1.0.0
        with:
          host: ${{ secrets.MAIN_SSH_HOST }}
          port: ${{ secrets.MAIN_SSH_PORT }}
          username: ${{ secrets.MAIN_SSH_USER }}
          key: ${{ secrets.MAIN_SSH_SSH_KEY }}
          script: |
            bash /app/kanta_maruhashi/deploy.sh kanta_maruhashi
