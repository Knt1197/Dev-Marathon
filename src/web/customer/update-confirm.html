<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>顧客情報更新の確認</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../assets/css/style.css" />
  </head>
  <body>
    <div class="app-shell">
      <header class="app-header">
      <div class="container d-flex justify-content-between align-items-center">
        <div>
          <h1 class="app-title mb-0">
            <a href="../index.html" class="text-white text-decoration-none">顧客管理システム</a>
          </h1>
        </div>
        <nav>
          <ul class="nav">
            <li class="nav-item"><a class="nav-link text-white active" href="./list.html">顧客</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="../case/list.html">案件</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="../negotiation/list.html">交渉</a></li>
          </ul>
        </nav>
      </div>
    </header>

      <section class="app-card">
        <h2 class="h5 mb-4">更新予定の情報</h2>
        <div class="info-grid">
          <div class="info-item">
            <h5>会社名</h5>
            <p id="company_name">-</p>
          </div>
          <div class="info-item">
            <h5>業種</h5>
            <p id="industry">-</p>
          </div>
          <div class="info-item">
            <h5>連絡先</h5>
            <p id="contact">-</p>
          </div>
          <div class="info-item">
            <h5>所在地</h5>
            <p id="location">-</p>
          </div>
        </div>
        <div class="d-flex justify-content-end mt-4">
          <button id="confirm-button" class="btn btn-success">この内容で更新</button>
        </div>
      </section>
    </div>

    <script type="module">
      import config from "../config.js";

      const params = new URLSearchParams(window.location.search);
      const customerData = {
        customerId: params.get("customerId"),
        company_name: params.get("company_name"),
        industry: params.get("industry"),
        contact: params.get("contact"),
        location: params.get("location"),
      };

      ["company_name", "industry", "contact", "location"].forEach((field) => {
        const target = document.getElementById(field);
        if (target) {
          target.textContent = customerData[field] || "-";
        }
      });

      document.getElementById("confirm-button").addEventListener("click", () => {
        fetch(`${config.apiUrl}/customers/${customerData.customerId}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(customerData),
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.success) {
              alert("顧客情報を更新しました。");
              window.location.href = `detail.html?id=${customerData.customerId}`;
            } else {
              alert("更新に失敗しました。");
            }
          })
          .catch(() => {
            alert("エラーが発生しました。");
          });
      });
    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  </body>
</html>
