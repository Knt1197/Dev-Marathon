<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>顧客情報の確認</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" />
    <link rel="stylesheet" href="../assets/css/style.css" />
  </head>
  <body>
    <div class="app-shell">
      <header class="app-header">
      <div class="container d-flex justify-content-between align-items-center">
        <div>
          <h1 class="app-title mb-0">
            <a href="../index.html" class="text-white text-decoration-none">顧客管理システム</a>
          </h1>
        </div>
        <nav>
          <ul class="nav">
            <li class="nav-item"><a class="nav-link text-white active" href="./list.html">顧客</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="../case/list.html">案件</a></li>
            <li class="nav-item"><a class="nav-link text-white" href="../negotiation/list.html">交渉</a></li>
          </ul>
        </nav>
      </div>
    </header>

      <section class="app-card">
        <h2 class="h5 mb-4">登録予定の情報</h2>
        <div class="info-grid">
          <div class="info-item">
            <h5>会社名</h5>
            <p id="companyName">-</p>
          </div>
          <div class="info-item">
            <h5>業種</h5>
            <p id="industry">-</p>
          </div>
          <div class="info-item">
            <h5>連絡先</h5>
            <p id="contact">-</p>
          </div>
          <div class="info-item">
            <h5>所在地</h5>
            <p id="location">-</p>
          </div>
        </div>
        <div class="d-flex justify-content-end mt-4">
          <button id="confirm-button" class="btn btn-success">この内容で登録</button>
        </div>
      </section>
    </div>

    <script type="module">
      import config from "../config.js";

      const params = new URLSearchParams(window.location.search);
      const customerData = {
        companyName: params.get("companyName"),
        industry: params.get("industry"),
        contact: params.get("contact"),
        location: params.get("location"),
      };

      Object.entries(customerData).forEach(([key, value]) => {
        const target = document.getElementById(key);
        if (target) target.textContent = value || "-";
      });

      document.getElementById("confirm-button").addEventListener("click", () => {
        fetch(`${config.apiUrl}/add-customer`, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams(customerData),
        })
          .then((response) => {
            if (!response.ok) {
              return response.json().then((err) => Promise.reject(err));
            }
            return response.json();
          })
          .then((data) => {
            if (data.success) {
              alert("顧客情報が正常に保存されました。");
              window.location.href = "list.html";
            } else {
              alert("保存に失敗しました。");
            }
          })
          .catch((error) => {
            const message = error.message || "エラーが発生しました。";
            alert(message);
          });
      });
    </script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
  </body>
</html>
